{
 "system": "You are an expert software architect who specializes in large-scale distributed systems and microservices architecture.\nEvaluate architectural decisions considering performance implications, security vulnerabilities, maintainability challenges, scalability constraints, and long-term technical debt across complex enterprise systems with millions of users.\n\n**Important formatting requirements:**\n- Use proper markdown tables with | separators and header rows\n- Format all tables as: | Column 1 | Column 2 | with |---|---| separator\n- Use bullet points and numbered lists for clarity\n- Include mermaid diagrams when helpful for visualization",
 "messages": [
  {
   "role": "user",
   "content": [
    {
     "text": "## System Architecture ##\n\n**Current Monolithic E-commerce Platform (500K LOC)**\n\n```python\n# Core monolith structure\necommerce_platform/\n\u251c\u2500\u2500 user_management/     # 50K LOC - User auth, profiles, preferences\n\u2502  \u251c\u2500\u2500 authentication.py   # OAuth2, JWT, session management\n\u2502  \u251c\u2500\u2500 user_profiles.py   # Profile CRUD, preferences, settings\n\u2502  \u2514\u2500\u2500 permissions.py    # RBAC, admin controls\n\u251c\u2500\u2500 product_catalog/     # 80K LOC - Product data, search, recommendations\n\u2502  \u251c\u2500\u2500 product_models.py   # Complex product hierarchy, variants\n\u2502  \u251c\u2500\u2500 search_engine.py   # Elasticsearch integration, faceted search\n\u2502  \u251c\u2500\u2500 recommendations.py  # ML-based product recommendations\n\u2502  \u2514\u2500\u2500 inventory.py     # Real-time inventory tracking\n\u251c\u2500\u2500 order_processing/     # 120K LOC - Cart, checkout, fulfillment\n\u2502  \u251c\u2500\u2500 shopping_cart.py   # Session-based cart, persistence\n\u2502  \u251c\u2500\u2500 checkout.py      # Multi-step checkout, validation\n\u2502  \u251c\u2500\u2500 payment_processing.py # Multiple payment gateways, PCI compliance\n\u2502  \u251c\u2500\u2500 order_fulfillment.py # Warehouse integration, shipping\n\u2502  \u2514\u2500\u2500 returns.py      # Return processing, refunds\n\u251c\u2500\u2500 customer_service/     # 60K LOC - Support, chat, tickets\n\u2502  \u251c\u2500\u2500 support_tickets.py  # Ticket management, SLA tracking\n\u2502  \u251c\u2500\u2500 live_chat.py     # Real-time chat, agent routing\n\u2502  \u2514\u2500\u2500 knowledge_base.py   # FAQ, documentation system\n\u251c\u2500\u2500 analytics/        # 90K LOC - Reporting, BI, ML pipelines\n\u2502  \u251c\u2500\u2500 event_tracking.py   # User behavior tracking, analytics\n\u2502  \u251c\u2500\u2500 reporting.py     # Business intelligence, dashboards\n\u2502  \u2514\u2500\u2500 ml_pipelines.py    # Recommendation training, A/B testing\n\u2514\u2500\u2500 shared/          # 100K LOC - Common utilities, integrations\n  \u251c\u2500\u2500 database.py      # ORM, connection pooling, migrations\n  \u251c\u2500\u2500 caching.py      # Redis, memcached, cache strategies\n  \u251c\u2500\u2500 messaging.py     # RabbitMQ, event publishing\n  \u2514\u2500\u2500 external_apis.py   # Payment, shipping, tax integrations\n  ```\n\n**Current Performance Metrics**\n- Response time: 200ms (p50), 800ms (p95), 2.5s (p99)\n- Throughput: 5,000 requests/minute peak\n- Database: PostgreSQL, 2TB data, 500 concurrent connections\n- Infrastructure: 12 application servers, 3 database replicas\n- Deployment: 45-minute deployments, 2-week release cycles\n- Incidents: 15 production issues/month, 99.2% uptime\n\n**Scaling Challenges**\n- Database bottlenecks during flash sales (10x traffic spikes)\n- Memory usage: 8GB per app server, frequent GC pauses\n- Code coupling: Changes in one module often break others\n- Testing: 6-hour test suite, flaky integration tests\n- Team coordination: 25 developers, merge conflicts, blocking dependencies\n\n**Business Requirements**\n- Scale to 50,000 requests/minute (10x current)\n- Support international expansion (5 new countries)\n- Reduce deployment time to <10 minutes\n- Improve developer velocity (faster feature delivery)\n- Achieve 99.9% uptime SLA\n- Support real-time features (live inventory, chat)\n\n**Technology Constraints**\n- Must maintain PCI DSS compliance\n- Legacy integrations with 15 external systems\n- Existing PostgreSQL data (complex migration)\n- Team expertise: Strong Python, limited microservices experience\n- Budget: $2M for infrastructure changes over 18 months\n\n## Architecture Challenge ##\n\nEvaluate whether TechFlow should migrate from their monolithic architecture to microservices, and if so, design the optimal migration strategy.\n\nProvide architectural analysis covering:\n\n1. **System-Wide Impact Assessment**: Analyze how microservices migration would affect each component. Consider data consistency requirements, transaction boundaries, and inter-service communication patterns. Identify which modules are good candidates for extraction and which should remain coupled.\n\n2. **Performance Implications Analysis**: Model the performance impact of network latency, service-to-service calls, and distributed transactions. Compare current monolith performance with projected microservices performance under various load scenarios. Consider caching strategies, data locality, and query optimization.\n\n3. **Security Architecture Review**: Evaluate security implications of distributed architecture. Analyze authentication/authorization across services, network security, data encryption in transit/at rest, and compliance requirements (PCI DSS). Identify new attack vectors and mitigation strategies.\n\n4. **Dependency and Data Flow Analysis**: Map current tight coupling and shared database dependencies. Design service boundaries that minimize cross-service transactions. Analyze data consistency requirements and propose eventual consistency vs strong consistency trade-offs.\n\n5. **Migration Strategy & Risk Assessment**: Design a phased migration approach that minimizes business disruption. Identify the optimal order for service extraction, considering dependencies and risk levels. Propose strangler fig pattern implementation with specific timelines and rollback strategies.\n\n6. **Operational Complexity Evaluation**: Assess the operational overhead of managing 15-20 microservices vs 1 monolith. Consider monitoring, logging, debugging, deployment pipelines, and team structure changes. Evaluate DevOps tooling requirements and learning curve.\n\n7. **Alternative Architecture Recommendations**: If microservices aren't optimal, propose alternative approaches (modular monolith, service-oriented architecture, domain-driven design within monolith). Compare trade-offs and provide decision framework.\n\nConsider the team's current expertise, budget constraints, and business timeline. Provide specific recommendations for technology choices, infrastructure requirements, and organizational changes needed for success.\n\nAsk clarifying questions if needed."
    }
   ]
  }
 ],
 "additionalModelRequestFields": {
  "reasoningConfig": {
   "type": "enabled",
   "maxReasoningEffort": "low"
  }
 }
}